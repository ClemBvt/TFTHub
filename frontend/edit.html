<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifier un champion - TFT Hub</title>
    <link rel="stylesheet" href="/styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
    <nav class="site-nav">
        <div class="nav-wrap">
            <a class="logo" href="index.html">TFT Hub</a>
            <div class="nav-links">
                <a href="champions-list.html">Voir les champions</a>
                <a href="create.html" class="btn">Créer un champion</a>
            </div>
        </div>
    </nav>

    <div id="toastContainer"></div>

    <div class="create-container">
        <div class="create-header">
            <h2>Modifier le champion</h2>
            <a href="#" onclick="goBack()" class="back-btn">← Retour</a>
        </div>

        <div id="loadingMessage" style="text-align: center; color: #9fb0d6; padding: 20px;">
            <i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>
            Chargement du champion...
        </div>

        <div class="form-card" id="formCard" style="display: none;">
            <form id="editChampionForm">
                <div class="form-group">
                    <label for="name">Nom du champion *</label>
                    <input type="text" id="name" name="name" placeholder="Ex: Ashe" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="cost">Coût *</label>
                        <input type="number" id="cost" name="cost" placeholder="Ex: 1" min="1" max="5" required>
                    </div>
                    <div class="form-group">
                        <label for="health">Santé *</label>
                        <input type="number" id="health" name="health" placeholder="Ex: 650" min="0" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="mana">Mana *</label>
                        <input type="number" id="mana" name="mana" placeholder="Ex: 50" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="armor">Armure *</label>
                        <input type="number" id="armor" name="armor" placeholder="Ex: 20" min="0" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="dps">DPS *</label>
                        <input type="number" id="dps" name="dps" placeholder="Ex: 50" min="0" step="0.1" required>
                    </div>
                    <div class="form-group">
                        <label for="attackSpeed">Vitesse d'attaque *</label>
                        <input type="number" id="attackSpeed" name="attackSpeed" placeholder="Ex: 0.75" min="0" step="0.01" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="magicResist">Résistance Magique *</label>
                        <input type="number" id="magicResist" name="magicResist" placeholder="Ex: 20" min="0" required>
                    </div>
                    <div class="form-group">
                        <label for="damage">Dégâts *</label>
                        <input type="number" id="damage" name="damage" placeholder="Ex: 50" min="0" step="0.1" required>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-submit"><i class="fas fa-save"></i> Enregistrer les modifications</button>
                    <button type="button" class="btn-cancel" onclick="goBack()">Annuler</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/champions';
        const form = document.getElementById('editChampionForm');
        const formCard = document.getElementById('formCard');
        const loadingMessage = document.getElementById('loadingMessage');
        let currentChampionId = null;

        // Get champion ID from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const championId = urlParams.get('id');

        if (championId) {
            currentChampionId = championId;
            loadChampion(championId);
        } else {
            loadingMessage.innerHTML = '<p style="color: #dc2626;">Erreur: ID du champion non spécifié.</p>';
        }

        async function loadChampion(id) {
            try {
                const response = await fetch(`${API_BASE_URL}/${id}`);
                
                if (!response.ok) {
                    throw new Error('Champion not found');
                }

                const champion = await response.json();
                populateForm(champion);
                loadingMessage.style.display = 'none';
                formCard.style.display = 'block';
            } catch (error) {
                console.error('Error loading champion:', error);
                loadingMessage.innerHTML = '<p style="color: #dc2626;">Erreur lors du chargement du champion.</p>';
            }
        }

        function populateForm(champion) {
            document.getElementById('name').value = champion.name || '';
            document.getElementById('cost').value = champion.cost || '';
            document.getElementById('health').value = champion.health || '';
            document.getElementById('mana').value = champion.mana || '';
            document.getElementById('armor').value = champion.armor || '';
            document.getElementById('dps').value = champion.dps || '';
            document.getElementById('attackSpeed').value = champion.attackSpeed || '';
            document.getElementById('magicResist').value = champion.magicResist || '';
            document.getElementById('damage').value = champion.damage || '';
        }

        function showToast(message, type = "success") {
            const container = document.getElementById("toastContainer");
            const toast = document.createElement("div");

            toast.className = "toast";
            if (type === "error") toast.classList.add("error");

            toast.textContent = message;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        function goBack() {
            if (currentChampionId) {
                window.location.href = `champions.html?id=${currentChampionId}`;
            } else {
                window.location.href = 'champions-list.html';
            }
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!currentChampionId) {
                showToast('Erreur: ID du champion non disponible', 'error');
                return;
            }

            const data = {
                name: String(document.getElementById('name').value),
                cost: Number(document.getElementById('cost').value),
                health: Number(document.getElementById('health').value),
                mana: Number(document.getElementById('mana').value),
                dps: Number(document.getElementById('dps').value),
                attackSpeed: Number(document.getElementById('attackSpeed').value),
                armor: Number(document.getElementById('armor').value),
                magicResist: Number(document.getElementById('magicResist').value),
                damage: Number(document.getElementById('damage').value)
            };

            try {
                const response = await fetch(`${API_BASE_URL}/${currentChampionId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    // Show success message
                    const successMsg = document.createElement('div');
                    successMsg.style.cssText = `
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: linear-gradient(135deg, #0ea5a4 0%, #0d9596 100%);
                        color: white;
                        padding: 40px;
                        border-radius: 12px;
                        box-shadow: 0 8px 32px rgba(14, 165, 164, 0.4);
                        z-index: 10000;
                        text-align: center;
                        font-size: 18px;
                        font-weight: 600;
                        max-width: 400px;
                    `;
                    successMsg.innerHTML = '<i class="fas fa-check-circle" style="font-size: 48px; margin-bottom: 16px; display: block;"></i>Champion modifié avec succès !';
                    document.body.appendChild(successMsg);
                    
                    setTimeout(() => {
                        window.location.href = `champions.html?id=${currentChampionId}`;
                    }, 1500);
                } else {
                    showToast('Erreur : ' + (result.error || 'Impossible de modifier le champion.'), 'error');
                }
            } catch (error) {
                console.error('Erreur modification champion :', error);
                showToast('Erreur lors de la communication avec le serveur.', 'error');
            }
        });
    </script>
</body>
</html>
